---
layout: post
title:  "맵리듀스에 대하여       "
date:   2019-03-19 15:58:10
categories: [DataScience]
comments: true
---

# 맵리듀스
## 맵 리듀스란?
데이터 처리를 위한 프로그래밍 모델로 대량의 데이터 셋을 처리하고 생성한다.

##  Key + Value = Record 
* 맵리듀스의 핵심은 Key-Value 쌍으로 데이터를 처리한다는 것이다.
* Key-Value를 항상 한 쌍으로 처리하여 Key와 Value가 하나로 합쳐진 '레코드'가 처리의 단위가 된다.

## 맵리듀스 과정
맵리듀스는 그 이름에서 알 수 있듯이 'Map'과 'Reduce' 작업으로 이루어져 있다. 중간중간에 맵리듀스 작업을 더 효율적으로 사용하기 위해서, 혹은 최적화를 위해서 이루어지는 프로세스 몇 개가 존재한다.

### 1. 입력 데이터
입력파일을 말한다. 보통은 텍스트를 많이 처리하지만, 경우에 따라서 이미지, 통계 자료 등 여러가지를 입력 데이터로 사용한다. 이 입력 파일은 HDFS에 적재되어 병렬처리를 위해 여러 머신에 분배된다.

### 2. 맵 : Map
매퍼는 맵리듀스에서 Map 작업을 수행하는 객체이며 맵은 일반적으로 텍스트 파일에서 개행문자(줄바꿈)를 기준으로 한 줄씩 읽어들여 입력 데이터를 원하는 Key-Value 형태로 만드는 작업이다.

### 3. 컴바이너 : Combiner
네트워크의 병목현상을 줄일 수 있는 좋은 수단으로 매퍼에서 출력된 Key-Value의 데이터 뭉치를 리듀서로 보낼 때, 적은 양의 데이터를 보낼 수 있도록 한다.
#### **<예시>** 
한 매퍼에서 나온 데이터가 아래와 같다면 리듀서에게 4개의 레코드를 보내기보다는 <span style="color:#f3150e">**'키'**</span>로 묶어서 전송되는 데이터의 양을 줄임
- 컴바이너 적용 전 : [사과, BlueApple] [바나나, Banana] [사과, RedApple] [사과, YellowApple]
- 컴바이너 적용 후 : [사과, {BlueApple, RedApple, YellowApple}], [바나나, Banana]

=> 이렇듯 정제되지 않은 4개의 레코드를 리듀서에게 전송하기 보다는 하나의 키로 묶어서 2개의 레코드만을 보내는 것이 훨씬 효율적임!

각 매퍼에 하나의 컴바이너가 실행되고 컴바이너는 대부분의 경우 사용자에 의해 커스터마이징 된다.

### 4. 셔플(파티셔너 작업 : Suffle, Partitioner)
컴바이너에 담겨진 레코드들을 리듀서로 전송하는 일련이 과정을 '셔플'이라 한다. 파티셔너는 각 매퍼에서 나온 출력 레코드들일 어느 리듀서로 가야할지를 정하는 작업이다. 
#### **<예시>**
매퍼 A와 B가 컴바이너를 거쳐서 나온 출력 레코드가 다음과 같다고 가정하자.
- 매퍼 A : [사과, {BlueApple, RedApple, YelloApple}], [바나나, Banana]
- 매퍼 B : [사과, {Blackapple}], [바나나, {Banana, BlueBanana}], [딸기, strawberry]

**같은 키를 가지는 레코드들은 같은 리듀서에서 처리되어야 함!**

![image](https://user-images.githubusercontent.com/28076434/54586180-9a256000-4a5f-11e9-8534-43eac1b3326e.png)

=> 해시코드를 사용하여 키를 해시코드로 바꾼 뒤, 리듀서의 갯수로 해시코드를 나눠서 나온 나머지로 리듀서를 결정한다!!

### 5. 정렬(Sort)
리듀서가 파티셔너로부터 레코드를 잘 받았다면, 리듀스 작업을 하기에 앞서 정렬이라는 전처리 작업을 수행한다. 용이한 리듀스 작업을 위해 키값을 기준으로 레코드들을 정렬한다.

### 6. 리듀스(Reduce)
정렬을 통해 리듀스 내부에서 같은 키를 가지는 레코드들을 한 곳으로 모았다면 리듀스 함수에서 한군데 모아진 레코드들을 순서대로 처리할 수 있다. 리듀서로 들어온 레코드들을 원하는 형태로 가공하여 결과 객체에 작성한 뒤 파일로 출력한다.

### 7. 출력파일
리듀서가 모든 작업을 끝내면 각 리듀서들은 처리한 레코드들을 파일로 출력한다. 각 리듀서마다 part-r-....의 포맷으로 결과를 출력한다.